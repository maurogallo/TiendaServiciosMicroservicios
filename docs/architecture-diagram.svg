<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1200" height="800">
  <defs>
    <style type="text/css"><![CDATA[
      .title { font: bold 28px Segoe UI, Arial, sans-serif; fill: #1f2937; }
      .subtitle { font: 16px Segoe UI, Arial, sans-serif; fill: #374151; }
      .box { fill: #ffffff; stroke: #111827; stroke-width: 2; rx: 8; ry: 8; }
      .box-gray { fill: #f3f4f6; stroke: #111827; stroke-width: 2; rx: 8; ry: 8; }
      .label { font: 15px Segoe UI, Arial, sans-serif; fill: #111827; }
      .small { font: 13px Segoe UI, Arial, sans-serif; fill: #374151; }
      .arrow { stroke: #0ea5e9; stroke-width: 2.5; marker-end: url(#arrowhead); }
      .arrow-event { stroke: #10b981; stroke-width: 2.5; stroke-dasharray: 6 4; marker-end: url(#arrowheadEvent); }
      .legend { font: 13px Segoe UI, Arial, sans-serif; fill: #111827; }
    ]]></style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#0ea5e9" />
    </marker>
    <marker id="arrowheadEvent" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10b981" />
    </marker>
  </defs>

  <!-- Title -->
  <text x="40" y="50" class="title">TiendaServicios — Arquitectura de alto nivel</text>
  <text x="40" y="78" class="subtitle">Microservicios + API Gateway + Mensajería (RabbitMQ) + Persistencia por servicio</text>

  <!-- Client box -->
  <rect x="60" y="120" width="200" height="70" class="box-gray"/>
  <text x="85" y="160" class="label">Cliente / Frontend</text>

  <!-- Gateway box -->
  <rect x="340" y="110" width="250" height="90" class="box"/>
  <text x="355" y="145" class="label">API Gateway</text>
  <text x="355" y="170" class="small">Agregación, orquestación, resiliencia</text>

  <!-- HTTP arrows: Client -> Gateway -->
  <line x1="260" y1="155" x2="340" y2="155" class="arrow"/>

  <!-- Services row -->
  <rect x="300" y="260" width="320" height="110" class="box-gray"/>
  <text x="315" y="285" class="small">Microservicios (HTTP síncrono, CQRS con MediatR)</text>

  <!-- Autor service -->
  <rect x="320" y="300" width="160" height="60" class="box"/>
  <text x="335" y="330" class="label">Api.Autor</text>

  <!-- Libros service -->
  <rect x="500" y="300" width="160" height="60" class="box"/>
  <text x="515" y="330" class="label">Api.Libros</text>

  <!-- Carrito service -->
  <rect x="680" y="300" width="180" height="60" class="box"/>
  <text x="695" y="330" class="label">Api.CarritoCompra</text>

  <!-- Gateway -> Services (HTTP) -->
  <line x1="465" y1="200" x2="400" y2="300" class="arrow"/>
  <line x1="500" y1="200" x2="580" y2="300" class="arrow"/>
  <line x1="535" y1="200" x2="770" y2="300" class="arrow"/>

  <!-- Databases per service -->
  <rect x="330" y="390" width="120" height="50" class="box-gray"/>
  <text x="340" y="420" class="small">DB Autor (EF Core)</text>

  <rect x="520" y="390" width="120" height="50" class="box-gray"/>
  <text x="530" y="420" class="small">DB Libros (EF Core)</text>

  <rect x="730" y="390" width="140" height="50" class="box-gray"/>
  <text x="740" y="420" class="small">DB Carrito (EF Core)</text>

  <!-- RabbitMQ Bus -->
  <rect x="940" y="280" width="190" height="80" class="box"/>
  <text x="955" y="310" class="label">RabbitMQ / Bus</text>
  <text x="955" y="330" class="small">Eventos y comandos</text>

  <!-- Async event arrows between services and bus -->
  <line x1="840" y1="330" x2="940" y2="320" class="arrow-event"/>
  <line x1="660" y1="330" x2="940" y2="320" class="arrow-event"/>
  <line x1="480" y1="330" x2="940" y2="320" class="arrow-event"/>

  <!-- Outgoing events from Bus to services (consumidores) -->
  <line x1="940" y1="340" x2="840" y2="360" class="arrow-event"/>
  <line x1="940" y1="340" x2="640" y2="360" class="arrow-event"/>
  <line x1="940" y1="340" x2="440" y2="360" class="arrow-event"/>

  <!-- Legend -->
  <rect x="60" y="560" width="360" height="120" class="box-gray"/>
  <text x="75" y="585" class="legend">Leyenda</text>
  <line x1="75" y1="605" x2="130" y2="605" class="arrow"/>
  <text x="140" y="610" class="legend">HTTP síncrono (REST a través del Gateway)</text>
  <line x1="75" y1="635" x2="130" y2="635" class="arrow-event"/>
  <text x="140" y="640" class="legend">Eventos/Comandos asíncronos (RabbitMQ)</text>

  <!-- Notes -->
  <text x="60" y="720" class="small">Cada microservicio implementa CQRS ligero con MediatR y persiste su propio esquema con EF Core.</text>
  <text x="60" y="742" class="small">El API Gateway agrega y orquesta llamadas a los servicios; la comunicación asíncrona usa RabbitMQ.</text>
</svg>
